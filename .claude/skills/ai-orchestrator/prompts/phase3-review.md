# 阶段3：代码审查提示词模板

## 你的任务

请作为资深代码审查专家，对阶段2生成的代码进行全面审查。

**生成的代码**：{从phase2_code.md读取}

## 审查维度

### 1. 代码质量（25分）
- **可读性**：变量命名、函数命名是否清晰？
- **结构性**：代码组织是否合理？模块划分是否清晰？
- **复杂度**：是否存在过度复杂的逻辑？嵌套层级是否过深？
- **注释**：注释是否充分？是否准确？

**评分标准**：
- 优秀（20-25分）：命名清晰、结构合理、复杂度低、注释充分
- 良好（15-19分）：大部分符合规范，少量改进空间
- 一般（10-14分）：存在明显问题，需要重构
- 差（0-9分）：可读性差，需要大量改进

### 2. 安全性（25分）
- **输入验证**：是否验证所有外部输入？
- **敏感信息**：API密钥、密码是否硬编码？
- **SQL注入**：数据库查询是否使用参数化？
- **XSS防护**：用户输入是否正确转义？
- **权限控制**：是否有适当的权限检查？

**评分标准**：
- 优秀（20-25分）：无安全漏洞，防护措施完善
- 良好（15-19分）：少量安全问题，影响较小
- 一般（10-14分）：存在中等安全风险
- 差（0-9分）：存在高危安全漏洞

### 3. 性能（20分）
- **算法效率**：时间复杂度是否合理？
- **资源使用**：内存使用是否优化？
- **数据库查询**：是否存在N+1问题？
- **缓存策略**：是否有合理的缓存？

**评分标准**：
- 优秀（16-20分）：性能优秀，无明显瓶颈
- 良好（12-15分）：性能良好，少量优化空间
- 一般（8-11分）：存在性能问题
- 差（0-7分）：严重性能问题

### 4. 可维护性（15分）
- **代码复用**：是否避免重复代码？
- **依赖管理**：依赖是否合理？版本是否固定？
- **测试覆盖**：是否有充分的单元测试？
- **文档**：README是否完整？

**评分标准**：
- 优秀（12-15分）：易于维护和扩展
- 良好（9-11分）：维护性良好
- 一般（6-8分）：存在维护难点
- 差（0-5分）：难以维护

### 5. 最佳实践（15分）
- **设计模式**：是否使用合适的设计模式？
- **错误处理**：异常处理是否完善？
- **日志记录**：是否有适当的日志？
- **配置管理**：配置是否外部化？

**评分标准**：
- 优秀（12-15分）：完全符合最佳实践
- 良好（9-11分）：大部分符合
- 一般（6-8分）：部分符合
- 差（0-5分）：不符合最佳实践

## 输出格式

请严格按照以下Markdown格式输出：

```markdown
# 代码审查报告

**审查时间**: 2025-12-04 12:00:00
**审查者**: Gemini 3 Pro
**代码来源**: 阶段2生成

---

## 总体评分

| 维度 | 得分 | 满分 | 评级 |
|------|------|------|------|
| 代码质量 | XX | 25 | 优秀/良好/一般/差 |
| 安全性 | XX | 25 | 优秀/良好/一般/差 |
| 性能 | XX | 20 | 优秀/良好/一般/差 |
| 可维护性 | XX | 15 | 优秀/良好/一般/差 |
| 最佳实践 | XX | 15 | 优秀/良好/一般/差 |
| **总分** | **XX** | **100** | **优秀/良好/一般/差** |

---

## 发现的问题

### 🔴 严重问题（必须修复）

1. **[问题类型]** 问题描述
   - **文件**: `src/main.py:42`
   - **问题**: 详细描述
   - **风险**: 安全/性能/功能影响
   - **修复建议**: 具体改进方法
   - **修复后代码**:
     ```python
     # 改进后的代码示例
     ```

### 🟡 中等问题（建议修复）

1. **[问题类型]** 问题描述
   - **文件**: `src/utils.py:15`
   - **问题**: 详细描述
   - **改进建议**: 具体优化方法

### 🟢 轻微问题（可选优化）

1. **[问题类型]** 问题描述
   - **改进建议**: 简要说明

---

## 优点总结

1. ✅ 代码结构清晰，模块划分合理
2. ✅ 注释充分，易于理解
3. ✅ [其他优点]

---

## 详细审查

### 代码质量审查

**可读性**: [评价]
**结构性**: [评价]
**复杂度**: [评价]
**注释**: [评价]

**具体问题**:
- [问题1]
- [问题2]

### 安全性审查

**输入验证**: [评价]
**敏感信息**: [评价]
**注入防护**: [评价]

**具体问题**:
- [问题1]
- [问题2]

### 性能审查

**算法效率**: [评价]
**资源使用**: [评价]
**数据库查询**: [评价]

**具体问题**:
- [问题1]
- [问题2]

### 可维护性审查

**代码复用**: [评价]
**依赖管理**: [评价]
**测试覆盖**: [评价]

**具体问题**:
- [问题1]
- [问题2]

### 最佳实践审查

**设计模式**: [评价]
**错误处理**: [评价]
**日志记录**: [评价]

**具体问题**:
- [问题1]
- [问题2]

---

## 优化建议

### 立即执行（高优先级）

1. **修复安全漏洞**
   - 问题：[描述]
   - 修复：[方法]

2. **性能优化**
   - 问题：[描述]
   - 优化：[方法]

### 后续改进（中优先级）

1. **重构建议**
   - 位置：[文件]
   - 理由：[原因]
   - 方法：[具体步骤]

### 长期优化（低优先级）

1. **架构改进**
   - 建议：[描述]
   - 收益：[好处]

---

## 改进后的关键代码示例

### 示例1：安全性改进

**原代码**:
```python
# 不安全的代码
password = "hardcoded_password"
```

**改进后**:
```python
# 安全的代码
import os
password = os.getenv("PASSWORD")
if not password:
    raise ValueError("PASSWORD环境变量未设置")
```

### 示例2：性能优化

**原代码**:
```python
# 低效的代码
for user in users:
    profile = db.query(Profile).filter(Profile.user_id == user.id).first()
```

**改进后**:
```python
# 高效的代码（避免N+1问题）
profiles = db.query(Profile).filter(Profile.user_id.in_([u.id for u in users])).all()
profile_map = {p.user_id: p for p in profiles}
```

---

## 审查总结

**总体评价**: [一段话总结代码质量]

**是否推荐使用**: ✅ 推荐 / ⚠️ 需改进后使用 / ❌ 不推荐

**关键建议**: [最重要的3条建议]

---

**审查完成！所有问题已详细标注，建议优先修复🔴严重问题。**
```

## 输出位置

将上述Markdown保存到：`.ai-orchestrator/phase3_review.md`

## 审查注意事项

1. **客观评价**：基于事实和标准，不要主观臆断
2. **提供示例**：对于问题，提供具体的改进代码
3. **优先级明确**：区分严重/中等/轻微问题
4. **平衡视角**：既要指出问题，也要肯定优点
5. **实用建议**：改进建议要具体可执行，不要空泛

---

**这是最后一个阶段，审查报告将直接呈现给用户，请确保专业、详尽、有价值！**
